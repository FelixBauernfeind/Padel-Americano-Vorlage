<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Americano Vorlage â€“ Padelzone</title>

<style>
* { box-sizing: border-box; }
body {
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI";
  background:#f5f5f7;
  margin:0;
  font-size:16px;
}
.header {
  background:#f59e0b;
  padding:16px 22px;
}
.header h1 { margin:0; font-size:28px; color:white; }
.header p { margin:6px 0 0; font-size:16px; color:white; opacity:.95; }

.content { padding:22px; max-width:1200px; margin:auto; }
.section { background:white; border-radius:16px; padding:20px; margin-bottom:24px; }
label { display:block; margin-bottom:10px; font-weight:500; }

input {
  width:100%;
  padding:12px;
  font-size:16px;
  border-radius:10px;
  border:1px solid #ccc;
}

#count { max-width:90px; margin-bottom:26px; }

button {
  width:100%;
  padding:14px;
  font-size:17px;
  background:#1d1d1f;
  color:white;
  border:none;
  border-radius:12px;
  margin-top:16px;
}

.grid {
  display:grid;
  grid-template-columns:repeat(2,minmax(0,1fr));
  gap:12px;
}

.match {
  display:grid;
  grid-template-columns:1fr 56px 24px 56px 1fr;
  align-items:center;
  text-align:center;
  gap:10px;
  margin-top:14px;
}

.team { font-weight:500; }
.pause { margin-top:12px; font-size:15px; font-style:italic; color:#666; }

table { width:100%; border-collapse:collapse; }
th,td { padding:10px; border-bottom:1px solid #ddd; text-align:left; }
</style>
</head>

<body>

<div class="header">
  <h1>Americano Vorlage</h1>
  <p>Padelzone â€“ Felix Nikolas Bauernfeind</p>
</div>

<div class="content">

<div class="section">
  <label>Anzahl Spieler</label>
  <input type="number" id="count" min="4">
  <div class="grid" id="players"></div>
  <button onclick="createPlan()">Spielplan erstellen</button>
</div>

<div id="plan"></div>

<div class="section">
  <button onclick="calculate()">ðŸ”¢ Ergebnisse berechnen</button>
</div>

<div class="section">
  <h2>Rangliste</h2>
  <table id="ranking"></table>
</div>

</div>

<script>
let stats = {};
let playerNames = [];
let scoreInputs = {}; // ðŸ”‘ NEU

/* ===== STORAGE ===== */
function saveState() {
  document.querySelectorAll(".score").forEach(inp => {
    if (inp.id) scoreInputs[inp.id] = inp.value;
  });

  localStorage.setItem("americanoState", JSON.stringify({
    count: count.value,
    playerNames,
    plan: plan.innerHTML,
    stats,
    scoreInputs
  }));
}

function loadState() {
  const raw = localStorage.getItem("americanoState");
  if (!raw) return;

  const s = JSON.parse(raw);
  count.value = s.count;
  playerNames = s.playerNames || [];
  stats = s.stats || {};
  scoreInputs = s.scoreInputs || {};

  renderPlayers();
  plan.innerHTML = s.plan || "";

  document.querySelectorAll(".score").forEach(inp => {
    if (scoreInputs[inp.id] !== undefined) {
      inp.value = scoreInputs[inp.id];
    }
    inp.addEventListener("input", saveState);
  });

  updateRanking();
}

/* ===== SPIELER ===== */
function renderPlayers() {
  players.innerHTML = "";
  for (let i = 0; i < count.value; i++) {
    const val = playerNames[i] || "";
    playerNames[i] = val;
    players.innerHTML += `
      <input value="${val}"
        oninput="playerNames[${i}]=this.value; saveState();"
        placeholder="Spieler ${i+1}">
    `;
  }
  saveState();
}
count.onchange = renderPlayers;

/* ===== SPIELPLAN ===== */
function createPlan() {
  plan.innerHTML = "";
  stats = {};
  scoreInputs = {};

  const playersList = playerNames.filter(n => n.trim());
  playersList.forEach(p => stats[p] = { points:0, games:0 });

  const rounds = playersList.length - 1;
  let rotation = [...playersList];

  for (let r = 0; r < rounds; r++) {
    const round = document.createElement("div");
    round.className = "section";
    round.innerHTML = `<strong>Runde ${r+1}</strong>`;

    let active = [...rotation];
    const pause = [];
    while (active.length % 4 !== 0) pause.push(active.pop());

    let matchIndex = 0;
    for (let i = 0; i < active.length; i += 4) {
      const A = [active[i], active[i+1]];
      const B = [active[i+2], active[i+3]];

      const m = document.createElement("div");
      m.className = "match";

      const idA = `r${r}-m${matchIndex}-A`;
      const idB = `r${r}-m${matchIndex}-B`;

      m.dataset.teamA = A.join("|");
      m.dataset.teamB = B.join("|");

      m.innerHTML = `
        <div class="team">${A.join(" & ")}</div>
        <input class="score" id="${idA}" type="number">
        <div>:</div>
        <input class="score" id="${idB}" type="number">
        <div class="team">${B.join(" & ")}</div>
      `;
      round.appendChild(m);
      matchIndex++;
    }

    if (pause.length) {
      const p = document.createElement("div");
      p.className = "pause";
      p.textContent = `Pause: ${pause.join(", ")}`;
      round.appendChild(p);
    }

    plan.appendChild(round);
    rotation.splice(1, 0, rotation.pop());
  }

  document.querySelectorAll(".score").forEach(inp =>
    inp.addEventListener("input", saveState)
  );

  saveState();
  updateRanking();
}

/* ===== AUSWERTUNG ===== */
function calculate() {
  Object.values(stats).forEach(s => { s.points = 0; s.games = 0; });

  document.querySelectorAll(".match").forEach(m => {
    const A = m.dataset.teamA.split("|");
    const B = m.dataset.teamB.split("|");

    const a = parseInt(m.querySelectorAll(".score")[0].value);
    const b = parseInt(m.querySelectorAll(".score")[1].value);

    if (!isNaN(a)) A.forEach(p => { stats[p].points += a; stats[p].games++; });
    if (!isNaN(b)) B.forEach(p => { stats[p].points += b; stats[p].games++; });
  });

  saveState();
  updateRanking();
}

function updateRanking() {
  const rows = Object.entries(stats).map(([n,s]) => ({
    name:n,
    games:s.games,
    points:s.points,
    ppg:(s.games ? s.points/s.games : 0).toFixed(2)
  }));

  rows.sort((a,b)=>b.ppg-a.ppg || b.points-a.points || a.name.localeCompare(b.name));

  ranking.innerHTML = `
    <tr><th>Spieler</th><th>Spiele</th><th>Punkte</th><th>Punkte/Spiel</th></tr>
  `;
  rows.forEach(r=>{
    ranking.innerHTML += `
      <tr>
        <td>${r.name}</td>
        <td>${r.games}</td>
        <td>${r.points}</td>
        <td>${r.ppg}</td>
      </tr>
    `;
  });
}

/* INIT */
loadState();
if (!count.value) {
  count.value = 8;
  renderPlayers();
}
</script>

</body>
</html>
